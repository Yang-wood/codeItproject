<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic :: setContent(~{this::contentWrapper})}">
	<th:block th:fragment="contentWrapper">
		<div th:replace="~{/book/subheader :: withSubHeader(~{this::myActualPageContent})}">
			<th:block th:fragment="myActualPageContent">
				<div class="container py-4">
					<div class="container">
				        <form class="mb-4 mt-5" method="get" action="/book/search" id="searchForm">
				            <div class="row g-2 align-items-end justify-content-center">
				                <div class="col-md-2">
				                    <select id="searchType" name="type" class="form-select">
				                        <option value="all" th:selected="${type == 'all'}">통합검색</option>
				                        <option value="title" th:selected="${type == 'title'}">제목</option>
				                        <option value="author" th:selected="${type == 'author'}">작가</option>
				                        <option value="category" th:selected="${type == 'category'}">카테고리</option>
				                        <option value="point" th:selected="${type == 'point'}">포인트</option>
				                    </select>
				                </div>
				                <div class="col-md-6">
				                    <input type="text" id="keyword" name="keyword" class="form-control" th:value="${keyword}"> </div>
				                <div class="col-md-2">
				                    <button type="submit" class="btn btn-primary">검색</button>
				                </div>
				            </div>
							<div class="row g-2 align-items-end justify-content-end mt-2">
								<div class="col-md-1 offset-md-8">
									<select id="pageSize" name="size" class="form-select">
										<option value="10" th:selected="${page.size == 10}">10개</option>
										<option value="20" th:selected="${page.size == 20}">20개</option>
										<option value="30" th:selected="${page.size == 30}">30개</option>
										<option value="50" th:selected="${page.size == 50}">50개</option>
									</select>
								</div>
							</div>
				        </form>
					</div>
					
			        <hr>
			
			        <div id="bookListContainer">
			            <div th:if="${#lists.isEmpty(books)}" class="text-center text-muted mt-5">
			                <p>검색 결과가 없습니다.</p>
			            </div>
			            <div th:each="book : ${books}" class="book-item d-flex align-items-start">
			                <img th:src="${book.coverImage}" alt="표지" class="book-cover">
			                <div class="book-info">
			                    <div class="book-title" th:text="${book.title}">도서 제목</div>
			                    <div class="text-muted mb-1">
			                        저자 : <span th:text="${book.author}">저자</span> |
			                        출판사 : <span th:text="${book.publisher}">출판사</span>
			                    </div>
			                    <div class="book-description" th:text="${book.description}">
			                        도서 설명
			                    </div>
			                </div>
			                <div class="book-buttons">
			                	<button th:if="${book.wishedByCurrentUser == true}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-primary wishBtn">♥</button>
			                    <button th:if="${book.wishedByCurrentUser != true}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-outline-primary wishBtn">♡</button>
			                    
			                    <a th:if="${book.rentedByCurrentUser  == true}"
			                       th:href="@{/book/epubRead(bookId=${book.bookId})}" class="btn btn-primary read-button">열람하기</a>
			                    
			                    <button th:if="${book.rentedByCurrentUser != true}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-success rentBtn">대여하기</button>
			                    <div class="point-text">필요 포인트 : <span th:text="${book.rentPoint}">요구 포인트</span></div>
			                </div>
			            </div>
			        </div>
				
				    <div class="mt-4 text-center" th:if="${page.totalPages > 1}">
				        <nav>
				            <ul class="pagination justify-content-center">
				                <li class="page-item" th:if="${!page.first}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=0, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&lt;&lt;</a>
				                </li>
				                <li class="page-item" th:if="${!page.first}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.number - 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&lt;</a>
				                </li>
				                <li th:each="i : ${#numbers.sequence(startPage, endPage)}"
				                    th:classappend="${i} == ${page.number} ? 'active'" class="page-item">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${i}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       th:text="${i + 1}">1</a>
				                </li>
				                <li class="page-item" th:if="${!page.last}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.number + 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&gt;</a>
				                </li>
				                <li class="page-item" th:if="${!page.last}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.totalPages - 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&gt;&gt;</a>
				                </li>
				            </ul>
				        </nav>
				    </div>
				</div>
			</th:block>
		</div>
	</th:block>
</th:block>
	